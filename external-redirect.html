<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Production Redirect v163 - Aggressive Multi-Technique</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; background:#000; color:#0f0; font:12px/1.2 sans-serif; }
    .banner { width:320px; height:50px; display:flex; align-items:center; justify-content:center; gap:8px; }
    a { color:#0f0; text-decoration:underline; }
    .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); }
    iframe { position:absolute; top:-1000px; left:-1000px; width:1px; height:1px; }
  </style>
</head>
<body>
  <div class="sr-only">Controller v163</div>
  <div class="banner">
    <a href="#" data-mode="intent">intent</a>
    <a href="#" data-mode="market">market</a>
    <a href="#" data-mode="play">playhttps</a>
    <a href="#" data-mode="chrome">chrome</a>
    <a href="#" data-mode="geo">geo</a>
    <a href="#" data-mode="aggressive">aggressive</a>
  </div>

  <!-- Hidden iframe for navigation attempts -->
  <iframe id="redirectFrame" style="display:none;"></iframe>

  <script>
    (function(){
      const TAG = '[VUNGLE-CLICK]';
      console.log(TAG, 'üí• PRODUCTION REDIRECT v163 LOADED!');

      const INTENT = 'intent://www.google.com#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=https://www.google.com;end';
      const MARKET = 'market://details?id=com.android.chrome';
      const PLAY = 'https://play.google.com/store/apps/details?id=com.android.chrome';
      const CHROME_NAV = 'googlechrome://navigate?url=' + encodeURIComponent('https://www.google.com');
      const GEO = 'geo:37.4220,-122.0841?q=Googleplex';
      const GOOGLE = 'https://www.google.com';

      // URL-based parameter parsing
      const urlStr = location.href;
      const modeMatch = urlStr.match(/[?&]mode=([^&]*)/);
      const mode = modeMatch ? modeMatch[1].toLowerCase() : 'intent';
      
      let attempted = false;
      console.log(TAG, 'üîç FULL URL:', urlStr);
      console.log(TAG, 'üîç MODE EXTRACTED:', mode);

      function nav(url, label, useReplace) {
        if (attempted) return;
        attempted = true;
        console.log(TAG, 'üöÄ Attempt (single) ‚Üí', label, url);
        try { useReplace ? window.location.replace(url) : window.location.href = url; }
        catch(e){ console.log(TAG, '‚ùå Exception', label, String(e)); }
      }

      function runSelected() {
        console.log(TAG, 'üîç DEBUG: mode value is "' + mode + '" (length=' + mode.length + ')');
        switch (mode) {
          case 'intent': return nav(INTENT, 'intent', false);
          case 'market': return nav(MARKET, 'market', false);
          case 'play': return nav(PLAY, 'playhttps', true);
          case 'chrome': return nav(CHROME_NAV, 'chrome navigate', false);
          case 'geo': return nav(GEO, 'geo', false);
          case 'aggressive': 
            console.log(TAG, 'üí• AGGRESSIVE MODE MATCHED!');
            return runAggressiveStrategy();
          default: 
            console.log(TAG, '‚ùå NO MATCH - using default intent');
            return nav(INTENT, 'intent (default)', false);
        }
      }

      function runAggressiveStrategy() {
        if (attempted) return;
        attempted = true;
        
        console.log(TAG, 'üí• Aggressive Multi-Technique Strategy');
        
        // Technique 1: Document.write with meta refresh
        try {
          console.log(TAG, 'üî• Technique 1: document.write meta refresh');
          document.write('<meta http-equiv="refresh" content="0;url=' + GOOGLE + '">');
        } catch(e) { console.log(TAG, '‚ùå document.write failed:', e); }
        
        // Technique 2: Hidden iframe navigation
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 2: iframe navigation');
            const iframe = document.getElementById('redirectFrame');
            iframe.src = GOOGLE;
          } catch(e) { console.log(TAG, '‚ùå iframe failed:', e); }
        }, 100);
        
        // Technique 3: Window.open with immediate focus
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 3: window.open');
            const win = window.open(GOOGLE, '_blank');
            if (win) win.focus();
          } catch(e) { console.log(TAG, '‚ùå window.open failed:', e); }
        }, 200);
        
        // Technique 4: Form submission
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 4: form submission');
            const form = document.createElement('form');
            form.method = 'GET';
            form.action = GOOGLE;
            form.target = '_top';
            document.body.appendChild(form);
            form.submit();
          } catch(e) { console.log(TAG, '‚ùå form failed:', e); }
        }, 300);
        
        // Technique 5: Location.replace
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 5: location.replace');
            window.location.replace(GOOGLE);
          } catch(e) { console.log(TAG, '‚ùå location.replace failed:', e); }
        }, 400);
        
        // Technique 6: Location.href
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 6: location.href');
            window.location.href = GOOGLE;
          } catch(e) { console.log(TAG, '‚ùå location.href failed:', e); }
        }, 500);
        
        // Technique 7: History manipulation
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 7: history.replaceState');
            history.replaceState(null, null, GOOGLE);
            window.location.reload();
          } catch(e) { console.log(TAG, '‚ùå history failed:', e); }
        }, 600);
        
        // Technique 8: Top-level window navigation
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 8: top.location');
            top.location = GOOGLE;
          } catch(e) { console.log(TAG, '‚ùå top.location failed:', e); }
        }, 700);
        
        // Technique 9: Parent window navigation
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 9: parent.location');
            parent.location = GOOGLE;
          } catch(e) { console.log(TAG, '‚ùå parent.location failed:', e); }
        }, 800);
        
        // Technique 10: Direct anchor navigation
        setTimeout(() => {
          try {
            console.log(TAG, 'üî• Technique 10: anchor click');
            const a = document.createElement('a');
            a.href = GOOGLE;
            a.target = '_top';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
          } catch(e) { console.log(TAG, '‚ùå anchor failed:', e); }
        }, 900);
      }

      window.addEventListener('beforeunload', () => console.log(TAG, '‚ö° BEFORE UNLOAD - NAVIGATION'));
      window.addEventListener('pagehide', () => console.log(TAG, 'üéâ PAGE HIDE - POSSIBLE EXTERNAL'));
      document.addEventListener('visibilitychange', () => console.log(TAG, 'üëÅÔ∏è VISIBILITY:', document.visibilityState));

      // Manual taps (still single-attempt guarded)
      document.querySelectorAll('.banner a').forEach(a => {
        a.addEventListener('click', function(e){ e.preventDefault(); navFor(a.dataset.mode); });
      });

      function navFor(m) {
        switch (m) {
          case 'intent': return nav(INTENT, 'intent (manual)');
          case 'market': return nav(MARKET, 'market (manual)');
          case 'play': return nav(PLAY, 'playhttps (manual)', true);
          case 'chrome': return nav(CHROME_NAV, 'chrome navigate (manual)');
          case 'geo': return nav(GEO, 'geo (manual)');
          case 'aggressive': return runAggressiveStrategy();
        }
      }

      // Auto-run exactly one variant after a brief delay (to allow logs to flush)
      setTimeout(runSelected, 900);
      console.log(TAG, 'üß≠ mode =', mode, '(pass ?mode=intent|market|play|chrome|geo|aggressive)');
    })();
  </script>
</body>
</html>
