<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Production Redirect v152 - Trampolines</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; background:#000; color:#0f0; font:12px/1.2 sans-serif; }
    .banner { width:320px; height:50px; display:flex; align-items:center; justify-content:center; gap:8px; }
    a { color:#0f0; text-decoration:underline; }
    .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); }
  </style>
</head>
<body>
  <div class="sr-only">Controller</div>
  <div class="banner">
    <a href="#" id="b1">blank‚Üíintent</a>
    <a href="#" id="b2">iframe‚Üíintent</a>
    <a href="#" id="b3">_top‚Üíintent</a>
  </div>

  <script>
    (function(){
      const TAG = '[VUNGLE-CLICK]';
      console.log(TAG, 'üéØ PRODUCTION REDIRECT v152 LOADED!');

      const INTENT = 'intent://www.google.com#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=https://www.google.com;end';
      const MARKET = 'market://details?id=com.android.chrome';

      function aboutBlankTrampoline() {
        console.log(TAG, 'ü™ü about:blank trampoline start');
        try {
          const w = window.open('about:blank', '_blank');
          if (w) {
            setTimeout(() => {
              try { w.location.href = INTENT; console.log(TAG, '‚û°Ô∏è child.location = intent://'); } catch(e) { console.log(TAG, '‚ùå child intent nav', String(e)); }
            }, 50);
            setTimeout(() => {
              try { w.location.href = MARKET; console.log(TAG, '‚û°Ô∏è child.location = market:// (fallback)'); } catch(e) { console.log(TAG, '‚ùå child market nav', String(e)); }
            }, 400);
          } else {
            console.log(TAG, '‚ö†Ô∏è window.open about:blank blocked');
          }
        } catch (e) {
          console.log(TAG, '‚ùå about:blank trampoline exception', String(e));
        }
      }

      function iframeSrcdocMeta() {
        console.log(TAG, 'üß© iframe srcdoc meta refresh to intent start');
        try {
          const html = '<meta http-equiv="refresh" content="0;url=' + INTENT.replace(/&/g, '&amp;') + '">';
          const ifr = document.createElement('iframe');
          ifr.setAttribute('sandbox', 'allow-scripts allow-forms');
          ifr.style.width = '1px'; ifr.style.height = '1px'; ifr.style.opacity = '0';
          ifr.srcdoc = html;
          document.body.appendChild(ifr);
        } catch (e) {
          console.log(TAG, '‚ùå iframe srcdoc exception', String(e));
        }
      }

      function topTargetAnchor() {
        console.log(TAG, 'üîó anchor target=_top intent start');
        try {
          const a = document.createElement('a');
          a.href = INTENT; a.target = '_top'; a.rel = 'noopener noreferrer';
          document.body.appendChild(a);
          a.click();
        } catch (e) {
          console.log(TAG, '‚ùå anchor _top exception', String(e));
        }
      }

      window.addEventListener('beforeunload', () => console.log(TAG, '‚ö° BEFORE UNLOAD - NAVIGATION'));
      window.addEventListener('pagehide', () => console.log(TAG, 'üéâ PAGE HIDE - POSSIBLE EXTERNAL'));
      document.addEventListener('visibilitychange', () => console.log(TAG, 'üëÅÔ∏è VISIBILITY:', document.visibilityState));

      // Manual taps
      document.getElementById('b1').addEventListener('click', function(e){ e.preventDefault(); aboutBlankTrampoline(); });
      document.getElementById('b2').addEventListener('click', function(e){ e.preventDefault(); iframeSrcdocMeta(); });
      document.getElementById('b3').addEventListener('click', function(e){ e.preventDefault(); topTargetAnchor(); });

      // Auto spaced attempts
      setTimeout(aboutBlankTrampoline, 900);
      setTimeout(iframeSrcdocMeta, 2400);
      setTimeout(topTargetAnchor, 3900);
    })();
  </script>
</body>
</html>

