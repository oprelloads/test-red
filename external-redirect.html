<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Production Redirect v156 - MRAID Path</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; background:#000; color:#0f0; font:12px/1.2 sans-serif; }
    .banner { width:320px; height:50px; display:flex; align-items:center; justify-content:center; gap:8px; }
    a { color:#0f0; text-decoration:underline; }
    .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); }
  </style>
</head>
<body>
  <div class="sr-only">Controller</div>
  <div class="banner">
    <a href="#" id="m1">mraid.open</a>
    <a href="#" id="m2">postMessage</a>
    <a href="#" id="m3">https _self</a>
  </div>

  <script>
    (function(){
      const TAG = '[VUNGLE-CLICK]';
      console.log(TAG, '🎯 PRODUCTION REDIRECT v156 LOADED!');

      const TARGET = 'https://www.google.com';

      function tryMraidOpen() {
        try {
          if (window.mraid && typeof window.mraid.open === 'function') {
            console.log(TAG, '📣 mraid.open available →', TARGET);
            window.mraid.open(TARGET);
            return true;
          }
          console.log(TAG, 'ℹ️ mraid.open not available');
        } catch (e) {
          console.log(TAG, '❌ mraid.open exception', String(e));
        }
        return false;
      }

      function setupMraidReady() {
        try {
          if (window.mraid && typeof window.mraid.addEventListener === 'function') {
            console.log(TAG, '⏳ Waiting for mraid.ready');
            window.mraid.addEventListener('ready', function(){
              console.log(TAG, '✅ mraid.ready');
              tryMraidOpen();
            });
          }
        } catch (e) {
          console.log(TAG, '❌ mraid listener exception', String(e));
        }
      }

      function tryPostMessage() {
        try {
          console.log(TAG, '📨 postMessage OPEN request');
          window.top.postMessage({ type: 'OPEN', url: TARGET }, '*');
        } catch (e) {
          console.log(TAG, '❌ postMessage exception', String(e));
        }
      }

      function httpsSelf() {
        try {
          console.log(TAG, '🌐 _self navigate →', TARGET);
          window.location.href = TARGET;
        } catch (e) {
          console.log(TAG, '❌ https _self exception', String(e));
        }
      }

      window.addEventListener('beforeunload', () => console.log(TAG, '⚡ BEFORE UNLOAD - NAVIGATION'));
      window.addEventListener('pagehide', () => console.log(TAG, '🎉 PAGE HIDE - POSSIBLE EXTERNAL'));
      document.addEventListener('visibilitychange', () => console.log(TAG, '👁️ VISIBILITY:', document.visibilityState));

      // Manual taps
      document.getElementById('m1').addEventListener('click', function(e){ e.preventDefault(); tryMraidOpen(); });
      document.getElementById('m2').addEventListener('click', function(e){ e.preventDefault(); tryPostMessage(); });
      document.getElementById('m3').addEventListener('click', function(e){ e.preventDefault(); httpsSelf(); });

      // Auto: attempt mraid immediately, then on ready, then fallback
      const mraidImmediate = tryMraidOpen();
      setupMraidReady();
      setTimeout(() => { if (!mraidImmediate) tryPostMessage(); }, 2000);
      setTimeout(() => httpsSelf(), 3500);
    })();
  </script>
</body>
</html>

